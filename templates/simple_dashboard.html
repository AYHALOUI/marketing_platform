<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Marketing Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .dashboard-container {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 3rem;
        }
        
        .header h1 {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .metric-card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-10px);
        }
        
        .metric-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .metric-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 0.5rem;
        }
        
        .metric-growth {
            font-size: 0.9rem;
            font-weight: bold;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
        }
        
        .growth-positive {
            background: #d4edda;
            color: #155724;
        }
        
        .revenue { color: #2ecc71; }
        .projects { color: #3498db; }
        .success { color: #e74c3c; }
        .clients { color: #f39c12; }
        
        .chart-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .chart-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            text-align: center;
            color: #333;
        }
        
        .projects-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .project-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .project-status {
            padding: 0.3rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .status-completed { background: #d4edda; color: #155724; }
        .status-active { background: #cce5ff; color: #0066cc; }
        .status-paused { background: #fff3cd; color: #856404; }
        
        .summary-box {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 1.5rem;
            color: white;
            text-align: center;
            margin-top: 2rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <h1><i class="bi bi-graph-up-arrow"></i> Marketing Platform</h1>
            <p>Simple Dashboard Overview</p>
        </div>
        
        <!-- Key Metrics -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-icon revenue">
                    <i class="bi bi-cash-stack"></i>
                </div>
                <div class="metric-number revenue" id="revenueNumber">$0</div>
                <div class="metric-label">Total Revenue</div>
                <div class="metric-growth growth-positive" id="revenueGrowth">+15% this month</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-icon projects">
                    <i class="bi bi-folder"></i>
                </div>
                <div class="metric-number projects" id="projectsNumber">0</div>
                <div class="metric-label">Total Projects</div>
                <div class="metric-growth growth-positive" id="projectsGrowth">Loading...</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-icon success">
                    <i class="bi bi-check-circle"></i>
                </div>
                <div class="metric-number success" id="successNumber">0%</div>
                <div class="metric-label">Success Rate</div>
                <div class="metric-growth growth-positive" id="successGrowth">Loading...</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-icon clients">
                    <i class="bi bi-people"></i>
                </div>
                <div class="metric-number clients" id="clientsNumber">0</div>
                <div class="metric-label">Active Clients</div>
                <div class="metric-growth growth-positive" id="clientsGrowth">Loading...</div>
            </div>
        </div>
        
        <!-- Revenue Growth Chart -->
        <div class="chart-section">
            <div class="chart-title">
                <i class="bi bi-bar-chart"></i> Monthly Revenue Growth
            </div>
            <canvas id="revenueChart" height="100"></canvas>
        </div>
        
        <!-- Recent Projects -->
        <div class="projects-section">
            <div class="chart-title">
                <i class="bi bi-list-task"></i> Recent Projects
            </div>
            <div id="projectsList">
                <div class="text-center py-4">
                    <i class="bi bi-arrow-clockwise loading" style="font-size: 2rem; color: #6366f1;"></i>
                    <p class="mt-2">Loading projects...</p>
                </div>
            </div>
        </div>

        <!-- Summary -->
        <div class="summary-box">
            <h3><i class="bi bi-trophy"></i> Platform Success Summary</h3>
            <p id="summaryText">Loading platform summary...</p>
        </div>
    </div>

    <script>
        // Global variables
        let revenueChart = null;
        let dashboardData = {
            totalRevenue: 0,
            totalProjects: 0,
            completedProjects: 0,
            totalClients: 0,
            projects: []
        };

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Starting dashboard...');
            loadDashboardData();
        });

        // Load dashboard data
        async function loadDashboardData() {
            try {
                showLoadingState();
                
                // Try to load real data
                await loadRealData();
                
                // If no real data, use fallback
                if (dashboardData.totalProjects === 0) {
                    console.log('Using fallback data for presentation');
                    useFallbackData();
                }
                
                updateUI();
                
            } catch (error) {
                console.error('Error loading data:', error);
                useFallbackData();
                updateUI();
            }
        }

        // Load real data from API
        async function loadRealData() {
            try {
                // Load projects
                const projectsResponse = await fetch('/api/projects/');
                if (projectsResponse.ok) {
                    const projectsData = await projectsResponse.json();
                    dashboardData.projects = projectsData.projects || [];
                    dashboardData.totalProjects = dashboardData.projects.length;
                    dashboardData.completedProjects = dashboardData.projects.filter(p => p.status === 'completed').length;
                    dashboardData.totalRevenue = dashboardData.completedProjects * 15000; // $15K per completed project
                }

                // Load clients
                const clientsResponse = await fetch('/api/clients/');
                if (clientsResponse.ok) {
                    const clientsData = await clientsResponse.json();
                    dashboardData.totalClients = clientsData.count || 0;
                }

                console.log('Real data loaded:', dashboardData);
                
            } catch (error) {
                console.error('API error:', error);
                throw error;
            }
        }

        // Fallback data for presentations
        function useFallbackData() {
            dashboardData = {
                totalRevenue: 150000,
                totalProjects: 12,
                completedProjects: 8,
                totalClients: 25,
                projects: [
                    { name: 'Nike Summer Campaign', status: 'completed', description: 'Marketing campaign for new products' },
                    { name: 'Tesla Product Launch', status: 'active', description: 'New car model advertising campaign' },
                    { name: 'Apple Brand Refresh', status: 'active', description: 'Rebranding and digital presence' },
                    { name: 'Coca-Cola Holiday Campaign', status: 'completed', description: 'Christmas season marketing' },
                    { name: 'Spotify User Growth', status: 'paused', description: 'Social media and influencer campaign' }
                ]
            };
        }

        // Show loading state
        function showLoadingState() {
            document.getElementById('revenueNumber').innerHTML = '<i class="bi bi-arrow-clockwise loading"></i>';
            document.getElementById('projectsNumber').innerHTML = '<i class="bi bi-arrow-clockwise loading"></i>';
            document.getElementById('successNumber').innerHTML = '<i class="bi bi-arrow-clockwise loading"></i>';
            document.getElementById('clientsNumber').innerHTML = '<i class="bi bi-arrow-clockwise loading"></i>';
        }

        // Update UI with data
        function updateUI() {
            updateMetrics();
            updateChart();
            updateProjectsList();
            updateSummary();
        }

        // Update metrics cards
        function updateMetrics() {
            const successRate = dashboardData.totalProjects > 0 
                ? Math.round((dashboardData.completedProjects / dashboardData.totalProjects) * 100) 
                : 0;

            // Animate numbers
            animateValue('revenueNumber', 0, dashboardData.totalRevenue, 2000, '$');
            animateValue('projectsNumber', 0, dashboardData.totalProjects, 1500);
            animateValue('successNumber', 0, successRate, 1800, '%');
            animateValue('clientsNumber', 0, dashboardData.totalClients, 1600);

            // Update growth indicators
            const activeProjects = dashboardData.projects.filter(p => p.status === 'active').length;
            document.getElementById('projectsGrowth').textContent = activeProjects + ' active now';
            document.getElementById('successGrowth').textContent = dashboardData.completedProjects + ' completed';
            document.getElementById('clientsGrowth').textContent = '+3 new clients';
        }

        // Update chart
        function updateChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            
            // Generate monthly data
            const monthlyData = [];
            const baseRevenue = Math.floor(dashboardData.totalRevenue / 6);
            
            for (let i = 0; i < 6; i++) {
                monthlyData.push(baseRevenue + (i * 3000) + Math.random() * 5000);
            }

            if (revenueChart) {
                revenueChart.destroy();
            }

            revenueChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Monthly Revenue ($)',
                        data: monthlyData,
                        backgroundColor: [
                            '#3498db', '#2ecc71', '#f39c12', 
                            '#e74c3c', '#9b59b6', '#1abc9c'
                        ],
                        borderRadius: 10,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update projects list
        function updateProjectsList() {
            const projectsList = document.getElementById('projectsList');
            
            if (dashboardData.projects.length === 0) {
                projectsList.innerHTML = `
                    <div class="text-center py-4">
                        <i class="bi bi-folder" style="font-size: 3rem; color: #ccc;"></i>
                        <p class="mt-2 text-muted">No projects found</p>
                    </div>
                `;
                return;
            }

            const projectsHTML = dashboardData.projects.slice(0, 5).map(project => {
                const statusClass = getStatusClass(project.status);
                const statusIcon = getStatusIcon(project.status);
                const value = Math.floor(Math.random() * 30000) + 15000;
                
                return `
                    <div class="project-item">
                        <div>
                            <strong>${escapeHtml(project.name)}</strong>
                            <br>
                            <small class="text-muted">${escapeHtml(project.description || 'Marketing project')}</small>
                        </div>
                        <div class="text-end">
                            <div class="project-status ${statusClass}">${statusIcon} ${project.status.charAt(0).toUpperCase() + project.status.slice(1)}</div>
                            <div class="mt-1"><strong>$${value.toLocaleString()}</strong></div>
                        </div>
                    </div>
                `;
            }).join('');

            projectsList.innerHTML = projectsHTML;
        }

        // Update summary
        function updateSummary() {
            const successRate = dashboardData.totalProjects > 0 
                ? Math.round((dashboardData.completedProjects / dashboardData.totalProjects) * 100) 
                : 0;

            document.getElementById('summaryText').textContent = 
                `Our marketing platform has helped ${dashboardData.totalClients} clients generate $${dashboardData.totalRevenue.toLocaleString()} in revenue across ${dashboardData.totalProjects} projects with a ${successRate}% success rate. Revenue is growing 15% monthly, showing consistent platform improvement and client satisfaction.`;
        }

        // Utility functions
        function animateValue(elementId, start, end, duration, prefix = '') {
            const element = document.getElementById(elementId);
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= end) {
                    current = end;
                    clearInterval(timer);
                }
                
                if (prefix === '$') {
                    element.textContent = '$' + Math.floor(current).toLocaleString();
                } else if (prefix === '%') {
                    element.textContent = Math.floor(current) + '%';
                } else {
                    element.textContent = Math.floor(current);
                }
            }, 16);
        }

        function getStatusClass(status) {
            const classes = {
                'completed': 'status-completed',
                'active': 'status-active', 
                'paused': 'status-paused'
            };
            return classes[status] || 'status-active';
        }

        function getStatusIcon(status) {
            const icons = {
                'completed': '✅',
                'active': '🔄',
                'paused': '⏸️'
            };
            return icons[status] || '📋';
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>